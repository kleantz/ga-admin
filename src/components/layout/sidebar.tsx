"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu"
import { 
  Home,
  Users,
  User,
  LogOut,
  MoreHorizontal,
  Key
} from "lucide-react"
import Link from "next/link"
import { usePathname, useRouter } from "next/navigation"
import { ChangePasswordDialog } from "@/components/change-password-dialog"

// GenAssist Logo Component
function GenAssistLogo() {
  return (
    <svg width="135" height="24" viewBox="0 0 135 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g clipPath="url(#clip0_1265_2819)">
        <path d="M24 11.9996H18.9903H12.0005V18.9912L5.0097 12.0005L12.0005 5.00883L17.754 10.7633H22.7637L12.0005 0L0 12.0005L12.0005 24L24.0009 12.0005L24 11.9996Z" fill="#2100B1"/>
        <path d="M39.303 10.0769H37.4874C37.2492 9.09396 36.8286 8.40762 36.2229 8.01885C35.6181 7.63008 34.7475 7.43526 33.6132 7.43526C32.4786 7.43526 31.6977 7.61061 31.1415 7.96218C30.5844 8.31375 30.1521 8.82651 29.8449 9.5022C29.5367 10.1779 29.3826 10.959 29.3826 11.8445C29.3826 12.7301 29.5367 13.5227 29.8449 14.1869C30.153 14.8511 30.5907 15.3567 31.1583 15.7021C31.7259 16.0484 32.4732 16.2211 33.4032 16.2211C34.1922 16.2211 34.8051 16.1316 35.2425 15.9536C35.6799 15.7756 36.0501 15.4028 36.3531 14.8351C36.6558 14.2675 36.8985 13.4926 37.0827 12.5087H33.7113V11.1795H38.0718C38.3961 11.1795 38.637 11.2663 38.7936 11.4389C38.9505 11.6116 39.0612 11.8764 39.1257 12.2333L40.1628 17.3395H38.736L37.9257 13.8548C37.6662 14.7847 37.3581 15.5188 37.0023 16.059C36.6018 16.6753 36.1404 17.0942 35.6163 17.3156C35.0919 17.537 34.3383 17.6477 33.3555 17.6477C31.9827 17.6477 30.9024 17.413 30.1134 16.9428C29.3242 16.4726 28.7087 15.8057 28.2651 14.9414C27.8223 14.0771 27.6009 13.0445 27.6009 11.8454C27.6009 10.6464 27.8249 9.60846 28.2739 8.73351C28.722 7.85856 29.3623 7.18554 30.1947 6.71529C31.0263 6.24504 32.1774 6.01038 33.6477 6.01038C34.8687 6.01038 35.8386 6.16179 36.5577 6.46377C37.2759 6.76665 37.8789 7.2174 38.3652 7.81695C38.8512 8.41647 39.1647 9.1701 39.3054 10.0778L39.303 10.0769Z" fill="black"/>
        <path d="M41.7825 17.3387V6.31677H51.5565V7.69473H43.5333V11.0661H51.2484V12.4113H43.5333V15.9448H51.5565V17.3387H41.7825Z" fill="black"/>
        <path d="M53.1771 17.3387V6.31677H55.0572L62.5626 15.2646V6.31677H64.2966V17.3387H62.4165L54.9279 8.39079V17.3387H53.1771Z" fill="black"/>
        <path d="M76.3731 17.3387L75.6114 15.4586H70.1007L69.339 17.3387H65.7567L70.3281 6.31677H75.4017L79.9563 17.3387H76.374H76.3731ZM71.2023 12.7841H74.5248L73.0008 9.03993H72.7254L71.2014 12.7841H71.2023Z" fill="black"/>
        <path d="M83.6835 9.62268C83.6835 9.91404 83.8809 10.0849 84.2751 10.1337C84.669 10.1824 85.0722 10.2311 85.4829 10.2798C85.8939 10.3285 86.3499 10.3825 86.853 10.4419C87.3552 10.5012 87.8226 10.5632 88.2549 10.6287C88.6869 10.6933 89.127 10.7775 89.5761 10.8802C90.0243 10.9829 90.4113 11.1556 90.7353 11.3992C91.0593 11.6427 91.2969 11.9774 91.4481 12.4043C91.5996 12.8311 91.6749 13.3253 91.6749 13.8876C91.6749 14.914 91.4562 15.7004 91.0188 16.2459C90.5811 16.7914 89.9754 17.1536 89.2032 17.3316C88.4301 17.5096 87.4659 17.5991 86.31 17.5991C85.1544 17.5991 84.1218 17.5096 83.3115 17.3316C82.5012 17.1536 81.8124 16.8047 81.2445 16.2866C80.6769 15.7686 80.3937 14.86 80.3937 13.5635H83.3601C83.3601 14.0063 83.6055 14.3552 84.0978 14.6085C84.5895 14.8626 85.2942 14.9893 86.2137 14.9893C87.1965 14.9893 87.8511 14.8812 88.1751 14.6652C88.4991 14.4491 88.6614 14.2064 88.6614 13.9354C88.6614 13.7087 88.4967 13.552 88.167 13.4652C87.8376 13.3784 87.4215 13.2898 86.9193 13.1977C86.4171 13.1056 85.9197 13.033 85.428 12.979C84.9366 12.925 84.4662 12.8736 84.0183 12.8249C83.5701 12.7762 83.1186 12.6868 82.665 12.5575C82.2117 12.4282 81.8166 12.252 81.4818 12.0306C81.1473 11.8092 80.8824 11.4797 80.6877 11.0414C80.4927 10.6039 80.3961 10.1204 80.3961 9.59082C80.3961 8.70522 80.5911 8.00475 80.9799 7.49199C81.3687 6.97923 81.993 6.61971 82.8519 6.41424C83.7108 6.2088 84.762 6.10608 86.0046 6.10608C87.2469 6.10608 88.2849 6.2088 89.019 6.41424C89.754 6.61971 90.375 6.99519 90.8832 7.54071C91.3905 8.08623 91.6449 8.88855 91.6449 9.9477H88.7595C88.7595 9.61296 88.5213 9.33753 88.0467 9.12057C87.5712 8.90448 86.9175 8.79645 86.0853 8.79645C85.0695 8.79645 84.4158 8.86905 84.1236 9.01518C83.8323 9.16131 83.6862 9.36411 83.6862 9.62268H83.6835Z" fill="black"/>
        <path d="M96.4068 9.62268C96.4068 9.91404 96.6042 10.0849 96.9981 10.1337C97.3923 10.1824 97.7952 10.2311 98.2062 10.2798C98.6172 10.3285 99.0732 10.3825 99.576 10.4419C100.078 10.5012 100.546 10.5632 100.978 10.6287C101.41 10.6933 101.85 10.7775 102.299 10.8802C102.747 10.9829 103.134 11.1556 103.459 11.3992C103.783 11.6427 104.02 11.9774 104.171 12.4043C104.323 12.8311 104.398 13.3253 104.398 13.8876C104.398 14.914 104.179 15.7004 103.742 16.2459C103.304 16.7914 102.699 17.1536 101.926 17.3316C101.153 17.5096 100.189 17.5991 99.0333 17.5991C97.8777 17.5991 96.8451 17.5096 96.0348 17.3316C95.2245 17.1536 94.5354 16.8047 93.9678 16.2866C93.4002 15.7686 93.1167 14.86 93.1167 13.5635H96.0834C96.0834 14.0063 96.3288 14.3552 96.8211 14.6085C97.3125 14.8626 98.0175 14.9893 98.9367 14.9893C99.9198 14.9893 100.574 14.8812 100.898 14.6652C101.222 14.4491 101.384 14.2064 101.384 13.9354C101.384 13.7087 101.22 13.552 100.89 13.4652C100.561 13.3784 100.145 13.2898 99.6426 13.1977C99.1404 13.1056 98.6427 13.033 98.1513 12.979C97.6599 12.925 97.1895 12.8736 96.7413 12.8249C96.2934 12.7762 95.8416 12.6868 95.3883 12.5575C94.9347 12.4282 94.5399 12.252 94.2051 12.0306C93.8703 11.8092 93.6057 11.4797 93.4107 11.0414C93.216 10.6039 93.1194 10.1204 93.1194 9.59082C93.1194 8.70522 93.3141 8.00475 93.7029 7.49199C94.0917 6.97923 94.716 6.61971 95.5752 6.41424C96.4341 6.2088 97.4853 6.10608 98.7279 6.10608C99.9702 6.10608 101.008 6.10608 101.742 6.41424C102.477 6.61971 103.098 6.99519 103.606 7.54071C104.114 8.08623 104.368 8.88855 104.368 9.9477H101.483C101.483 9.61296 101.245 9.33753 100.77 9.12057C100.294 8.90448 99.6408 8.79645 98.8083 8.79645C97.7925 8.79645 97.1391 8.86905 96.8469 9.01518C96.5553 9.16131 96.4092 9.36411 96.4092 9.62268H96.4068Z" fill="black"/>
        <path d="M105.694 17.3387V6.31677H109.001V17.3387H105.694Z" fill="black"/>
        <path d="M113.589 9.62268C113.589 9.91404 113.786 10.0849 114.18 10.1337C114.574 10.1824 114.977 10.2311 115.388 10.2798C115.799 10.3285 116.255 10.3825 116.758 10.4419C117.26 10.5012 117.728 10.5632 118.16 10.6287C118.592 10.6933 119.032 10.7775 119.481 10.8802C119.929 10.9829 120.316 11.1556 120.64 11.3992C120.964 11.6427 121.202 11.9774 121.353 12.4043C121.505 12.8311 121.58 13.3253 121.58 13.8876C121.58 14.914 121.361 15.7004 120.924 16.2459C120.486 16.7914 119.881 17.1536 119.108 17.3316C118.335 17.5096 117.371 17.5991 116.215 17.5991C115.06 17.5991 114.027 17.5096 113.217 17.3316C112.406 17.1536 111.717 16.8047 111.15 16.2866C110.582 15.7686 110.299 14.86 110.299 13.5635H113.265C113.265 14.0063 113.511 14.3552 114.003 14.6085C114.494 14.8626 115.199 14.9893 116.119 14.9893C117.102 14.9893 117.756 14.8812 118.08 14.6652C118.404 14.4491 118.566 14.2064 118.566 13.9354C118.566 13.7087 118.402 13.552 118.072 13.4652C117.743 13.3784 117.327 13.2898 116.824 13.1977C116.322 13.1056 115.825 13.033 115.333 12.979C114.841 12.925 114.371 12.8736 113.923 12.8249C113.475 12.7762 113.023 12.6868 112.57 12.5575C112.117 12.4282 111.722 12.252 111.387 12.0306C111.052 11.8092 110.788 11.4797 110.593 11.0414C110.398 10.6039 110.301 10.1204 110.301 9.59082C110.301 8.70522 110.496 8.00475 110.885 7.49199C111.274 6.97923 111.898 6.61971 112.757 6.41424C113.616 6.2088 114.667 6.10608 115.909 6.10608C117.152 6.10608 118.19 6.10608 118.924 6.41424C119.659 6.61971 120.28 6.99519 120.788 7.54071C121.296 8.08623 121.55 8.88855 121.55 9.9477H118.665C118.665 9.61296 118.426 9.33753 117.952 9.12057C117.476 8.90448 116.823 8.79645 115.99 8.79645C114.974 8.79645 114.321 8.86905 114.029 9.01518C113.737 9.16131 113.591 9.36411 113.591 9.62268H113.589Z" fill="black"/>
        <path d="M126.621 17.3387V8.99121H122.39V6.31677H134.158V8.99121H129.928V17.3387H126.621Z" fill="black"/>
      </g>
      <defs>
        <clipPath id="clip0_1265_2819">
          <rect width="134.7" height="24" fill="white"/>
        </clipPath>
      </defs>
    </svg>
  )
}

export default function Sidebar() {
  const pathname = usePathname()
  const router = useRouter()
  const [isChangePasswordOpen, setIsChangePasswordOpen] = useState(false)

  const navigation = [
    { name: 'Dashboard', href: '/dashboard', icon: Home },
    { name: 'Accounts', href: '/accounts', icon: Users },
  ]

  const handleLogout = () => {
    // Clear auth cookie
    document.cookie = "auth-token=; path=/; max-age=0"
    // Redirect to login
    router.push("/login")
  }

  return (
    <div className="w-64 bg-white border-r border-zinc-200 flex flex-col h-screen">
      {/* Sidebar Header */}
      <div className="p-2 flex-shrink-0">
        <div className="flex items-center justify-between p-2 rounded-md">
          {/* GenAssist Logo */}
          <div className="flex items-center space-x-2">
            <GenAssistLogo />
          </div>
          {/* Admin Badge */}
          <Badge variant="default" className="bg-[#4F46E5] text-white text-xs">
            Admin
          </Badge>
        </div>
      </div>

      {/* Main Navigation */}
      <div className="flex-1 overflow-y-auto p-2">
        <div className="space-y-1">
          {navigation.map((item) => {
            const isActive = pathname === item.href
            const Icon = item.icon
            
            return (
              <Link key={item.name} href={item.href}>
                  <Button 
                    variant="ghost" 
                    className={`w-full justify-start h-10 px-3 gap-3 ${
                      isActive 
                        ? 'bg-zinc-100 text-zinc-900 hover:bg-zinc-200' 
                        : 'text-zinc-600 hover:bg-zinc-100'
                    }`}
                  >
                    <Icon className="w-4 h-4" />
                    <span className="text-sm font-medium">{item.name}</span>
                  </Button>
              </Link>
            )
          })}
        </div>
      </div>

      {/* User Section - Bottom */}
      <div className="p-2 border-t border-zinc-200 flex-shrink-0">
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button 
              variant="ghost" 
              className="w-full justify-between text-zinc-600 hover:bg-zinc-100 h-10 px-3"
            >
              <div className="flex items-center gap-3">
                <User className="w-4 h-4" />
                <span className="text-sm font-medium">John Doe</span>
              </div>
              <MoreHorizontal className="w-4 h-4" />
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end" className="w-56">
            <DropdownMenuItem onClick={() => setIsChangePasswordOpen(true)}>
              <Key className="w-4 h-4" />
              Change Password
            </DropdownMenuItem>
            <DropdownMenuSeparator />
            <DropdownMenuItem onClick={handleLogout} className="text-red-600 focus:text-red-600">
              <LogOut className="w-4 h-4" />
              Logout
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </div>

      {/* Change Password Dialog */}
      <ChangePasswordDialog
        isOpen={isChangePasswordOpen}
        onClose={() => setIsChangePasswordOpen(false)}
      />
    </div>
  )
}
